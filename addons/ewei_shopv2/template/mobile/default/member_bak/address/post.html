{template '_header'}
<div class='fui-page  fui-page-current'>
    <div class="fui-header">
        <div class="fui-header-left">
            <a class="back"></a>
        </div>
        <div class="title">{if empty($address)}{php echo $lang['lang_template_mobile_member_address_post_0']}{else}{php echo $lang['lang_template_mobile_member_address_post_1']}{/if}</div>
        <div class="fui-header-right">&nbsp;</div>
    </div>
    <div class='fui-content'>
        <form method='post' class='form-ajax' >
            <input type='hidden' id='addressid' value="{$address['id']}"/>
            <div class='fui-cell-group'>
                <div class='fui-cell'>
                    <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_2']}</div>
                    <div class='fui-cell-info'><input type="text" id='realname'  name='realname' value="{$address['realname']}" placeholder="{php echo $lang['lang_template_mobile_member_address_post_3']}" class="fui-input"/></div>
                </div>
                <div class='fui-cell'>
                    <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_4']}</div>
                    <div class='fui-cell-info'><input type="tel" id='mobile' name='mobile' value="{$address['mobile']}" placeholder="{php echo $lang['lang_template_mobile_member_address_post_5']}"  class="fui-input"/></div>
                </div>
                    {if $_W['lang_type'] == 'ml' || $_W['lang_type'] == 'en'}
                    <div class='fui-cell'>
                        <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_6']}</div>
                        <div class="fui-cell-info">
                            <select name="area_province" id="province">
                                <option value="">{if !empty($address['province'])}{$address['province']}{else}Sila pilih keadaan{/if}</option>
                            </select>
                        </div>
                    </div>
                    <div class='fui-cell citys' {if empty($address['city'])} style="display:none" {/if}>
                        <div class='fui-cell-label'>Sila pilih bandar</div>
                        <div class="fui-cell-info">
                            <select name="area_city" id="city">
                                <option value="">{$address['city']}</option>
                            </select>
                        </div>
                    </div>
                    <div class='fui-cell towns' {if empty($address['area'])} style="display:none" {/if}>
                        <div class='fui-cell-label'>Sila pilih daerah</div>
                        <div class="fui-cell-info">
                            <select name="area_town" id="town">
                                <option value="">{$address['area']}</option>
                            </select>
                        </div>
                    </div>
                    {else}
                    <div class='fui-cell'>
                        <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_6']}</div>
                        <div class='fui-cell-info'>
                            <input type="text" id='areas' name='areas' data-value="{if !empty($show_data) && !empty($address)}{$address['datavalue']}{/if}" value="{if !empty($show_data) && !empty($address)}{$address['province']} {$address['city']} {$address['area']}{/if}" placeholder="{php echo $lang['lang_template_mobile_member_address_post_7']}"  class="fui-input" readonly=""/>
                        </div>
                    </div>
                    {/if}


                {if !empty($new_area) && !empty($address_street)}
                <div class='fui-cell'>
                    <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_8']}</div>
                    <div class='fui-cell-info'><input type="text" id='street'  name='street' data-value="{if !empty($address)}{$address['streetdatavalue']}{/if}" value="{if !empty($address)}{$address['street']}{/if}" placeholder="{php echo $lang['lang_template_mobile_member_address_post_9']}"  class="fui-input" readonly=""/></div>
                </div>
                {/if}

                <div class='fui-cell'>
                    <div class='fui-cell-label'>{php echo $lang['lang_template_mobile_member_address_post_10']}</div>
                    <div class='fui-cell-info'><input type="text" id='address' name='address' value="{$address['address']}" placeholder='{php echo $lang['lang_template_mobile_member_address_post_11']}'  class="fui-input"/></div>
                </div>
            </div>


            
            <a id="btn-submit" class='external btn btn-danger block'>{php echo $lang['lang_template_mobile_member_address_post_12']}</a>
              {if is_weixin() && $_W['shopset']['trade']['shareaddress']}
                 <a id="btn-address" class='btn btn-success block'>{php echo $lang['lang_template_mobile_member_address_post_13']}</a>
              {/if}


        </form>
    </div>
    <script language='javascript' type="text/javascript">

        require(['biz/member/address'], function (modal) {
            modal.initPost({new_area: {php echo $new_area}, address_street: {php echo $address_street},lang_type:"{php echo $_W['lang_type']}"});
        });
    </script>

</div>
<script>
    $(function(){
        // 声明ajax请求函数
        function getpct(urlname,pid){
            var url = '',name={};
            if(urlname == 1){
                url = "{php echo mobileUrl('member/address/get_province')}";
            }else if(urlname == 2){
                url = "{php echo mobileUrl('member/address/get_city')}" ;
                name = {'state_code':pid};
            }else if(urlname == 3){
                url = "{php echo mobileUrl('member/address/get_area')}"
                name = {'post_office':pid};
            }
            $.ajax({
                url:url,
                method:'GET',
                data:name,
                success:function(res){
                    res = JSON.parse(res);
                    if(urlname == 1){
                        let phtml = '';
                        for(var i = 0;i<res.result.province.length;i++){
                            phtml += '<option value="'+res.result.province[i].state_code+'">'+res.result.province[i].state_name+'</option>'
                        }
                        $('#province').append(phtml);
                    }else if(urlname == 2){
                        $('#city').html('');
                        let chtml = '';
                        for(var i = 0;i<res.result.city.length;i++){
                            chtml += '<option value="'+res.result.city[i].post_office+'">'+res.result.city[i].post_office+'</option>'
                        }
                        $('#city').append(chtml);
                    }else if(urlname == 3){
                        $('#town').html('');
                        let thtml = '';
                        for(var i = 0;i<res.result.area.length;i++){
                            thtml += '<option value="'+res.result.area[i].area+'">'+res.result.area[i].area+'</option>'
                        }
                        $('#town').append(thtml);
                    }
                },
                fail:function(msg){
                    console.log('请求错误'+msg)
                }
            })
        };
        getpct(1);
        //选择州
        $('#province').change(function(){
            let pid = $(this).val();
            if(pid != ''){
                $('.citys').show();
                getpct(2,pid);
            }
        })
        $('#city').change(function(){
            let cid = $(this).val();
            if(cid != ''){
                $('.towns').show();
                getpct(3,cid);
            }
        })
    })
</script>
{template '_footer'}
